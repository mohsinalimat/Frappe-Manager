services:
  frappe:
    image: ghcr.io/rtcamp/frappe-manager-frappe:v0.16.7
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    environment:
      USERID: REPLACE_ME_WITH_CURRENT_USER
      USERGROUP: REPLACE_ME_WITH_CURRENT_USER_GROUP
    volumes:
      - ./workspace:/workspace
    expose:
      - 80
    labels:
        devcontainer.metadata: '[{ "remoteUser": "frappe"}]'
    networks:
      site-network:
      global-backend-network:

  nginx:
    image: ghcr.io/rtcamp/frappe-manager-nginx:v0.16.1
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    user: REPLACE_ME_WITH_CURRENT_USER:REPLACE_ME_WITH_CURRENT_USER_GROUP
    environment:
      SITENAME: REPLACE_ME_WITH_THE_SITE_NAME
      VIRTUAL_HOST: REPLACE_ME_WITH_SITE_NAME
      VIRTUAL_PORT: 80
      HSTS: 'off'
    volumes:
      - ./workspace:/workspace
      - ./configs/nginx/conf:/etc/nginx
      - ./configs/nginx/logs:/var/log/nginx
      - ./configs/nginx/cache:/var/cache/nginx
      - ./configs/nginx/run:/var/run
      - ./configs/nginx/html:/usr/share/nginx/html
    expose:
      - 80
    networks:
      site-network:
      global-frontend-network:

  socketio:
    image: ghcr.io/rtcamp/frappe-manager-frappe:v0.16.7
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    environment:
      SUPERVISOR_SERVICE_CONFIG_FILE_NAME: socketio.fm.supervisor.conf
    expose:
      - 80
    command: launch_supervisor_service.sh
    volumes:
      - ./workspace:/workspace
    networks:
      site-network:

  schedule:
    image: ghcr.io/rtcamp/frappe-manager-frappe:v0.16.7
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    environment:
      SUPERVISOR_SERVICE_CONFIG_FILE_NAME: schedule.fm.supervisor.conf
    command: launch_supervisor_service.sh
    volumes:
      - ./workspace:/workspace
    networks:
      site-network:
      global-backend-network:

  redis-cache:
    image: redis:6.2-alpine
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    volumes:
      - redis-cache-data:/data
    expose:
      - 6379
    networks:
      site-network:

  redis-queue:
    image: redis:6.2-alpine
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    volumes:
      - redis-queue-data:/data
    expose:
      - 6379
    networks:
      site-network:

  redis-socketio:
    image: redis:6.2-alpine
    container_name: REPLACE_ME_WITH_CONTAINER_NAME
    volumes:
       - redis-socketio-data:/data
    expose:
      - 6379
    networks:
      site-network:

volumes:
  redis-socketio-data:
    name: VOLUMES_PREFIX__redis_socketio_data
  redis-queue-data:
    name: VOLUMES_PREFIX__redis_queue_data
  redis-cache-data:
    name: VOLUMES_PREFIX__redis_cache_data

networks:
  site-network:
    name: REPLACE_ME_WITH_SITE_NAME_NETWORK
  global-frontend-network:
    name: fm-global-frontend-network
    external: true
  global-backend-network:
    name: fm-global-backend-network
    external: true
